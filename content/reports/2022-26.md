---
categories: Daily
date: 2022-07-04T01:00:00Z
title: "2022-26: å“‘å·´è‹±è¯­é¦–æ¬¡å¼€å£"
tags:
  - open source
---

[Iteration 16](https://github.com/users/Xuanwo/projects/2/views/1?filterQuery=iteration%3A%22Iteration+16%22) ä» 6 æœˆ 18 å·å¼€å§‹åˆ° 7 æœˆ 3 å·ç»“æŸï¼Œä¸ºå…¶ä¸¤å‘¨ã€‚è¿™ä¸ªå‘¨æœŸæœ‰æ„æ€çš„äº‹æƒ…ä¸å°‘ï¼Œå…¶ä¸­å°è±¡æœ€æ·±åˆ»å°±æ˜¯å“‘å·´è‹±è¯­é¦–æ¬¡å¼€å£çš„ç»å†ã€‚

## ä¸ Mergify çš„é‡‡è®¿

[Mergify](https://mergify.com/) æ˜¯ä¸€ä¸ª Pull Request è‡ªåŠ¨åŒ–å·¥å…·ï¼Œä¸»è¦çš„åŠŸèƒ½åŒ…æ‹¬ Auto Mergeï¼ŒMerge Queueï¼ŒPR Actions ç­‰ã€‚[Databend](https://github.com/datafuselabs/databend) æœ€æ—©ä½¿ç”¨ä»–æ¥è§£å†³ PR è‡ªåŠ¨åˆå¹¶çš„é—®é¢˜ï¼Œåæ¥ä½¿ç”¨èŒƒå›´é€æ¸æ‰©å¤§ï¼Œç°åœ¨å·²ç»å°†æ‰€æœ‰çš„ PR ç›¸å…³çš„è‡ªåŠ¨åŒ–æµç¨‹éƒ½äº¤ç”± Mergify å¤„ç†ã€‚

æˆ‘ä»¬ä½¿ç”¨ Merfigy å®Œæˆå¦‚ä¸‹å·¥ä½œï¼š

- Auto Merge & Merge Queue è‡ªåŠ¨æ›´æ–° PRï¼Œç¡®ä¿æ‰€æœ‰ PR éƒ½åŸºäº main åˆ†æ”¯è¿è¡Œæµ‹è¯•åå†åˆå¹¶
- å‡ºç°å†²çªçš„æ—¶å€™è¯·æ±‚ä½œè€…è¿›è¡Œä¿®æ”¹
- æ£€æŸ¥ PR çš„æ ‡é¢˜å’Œå†…å®¹æ˜¯å¦ç¬¦åˆè¦æ±‚å¹¶è¯·æ±‚ä½œè€…è¿›è¡Œä¿®æ”¹
- æ ¹æ®è¯­ä¹‰åŒ–çš„ PR æ ‡é¢˜è‡ªåŠ¨æ·»åŠ å¯¹åº”çš„æ ‡ç­¾ä¾›ç”Ÿæˆ Release Note ä½¿ç”¨

> è¯¦ç»†çš„é…ç½®å‚è§ [mergify.yml](https://github.com/datafuselabs/databend/blob/main/.github/mergify.yml)

åæ¥å— Mergify çš„é‚€è¯·ï¼Œæˆ‘å‚åŠ äº†è·Ÿ Mergify åŒäº‹çš„è‹±æ–‡é‡‡è®¿ã€‚è¿™æ˜¯æˆ‘ç”Ÿå¹³ç¬¬ä¸€æ¬¡å‚åŠ è¿™ç§çº¯è‹±æ–‡çš„é¢è°ˆï¼Œæ„Ÿè§‰éå¸¸ç´§å¼ ã€‚Mergify é‚£è¾¹ç»™æˆ‘å‘æ¥äº†é—®é¢˜åˆ—è¡¨ï¼Œæˆ‘å¯¹ç€é—®é¢˜åˆ—è¡¨æå‰å‡†å¤‡äº†ä¸å°‘æ—¶é—´ï¼Œæ‹¿å‡ºäº†è‡ªå·±é«˜ä¸­èƒŒè‹±æ–‡è¯¾æ–‡çš„æ€åº¦æŠŠå›ç­”éƒ½èƒŒäº†ä¸€è½®ã€‚ä¸ºäº†é˜²æ­¢å‡ºä¸‘ï¼Œæˆ‘è¿˜è·Ÿç€ Google ç¿»è¯‘æŠŠæ¯ä¸€å¥è¯éƒ½è¯»äº†ä¸€éï¼Œé¿å…å‘éŸ³é”™è¯¯ã€‚

*çœŸåˆ°äº†é‡‡è®¿çš„æ—¶å€™æ„Ÿè§‰ä¹Ÿå°±é‚£æ ·ï¼Œ233333ã€‚*

å¯¹é¢æ˜¯ä¸€ä¸ªæ³•å›½äººï¼ŒåŒæ ·æœ‰ç€è‡ªå·±çš„å£éŸ³ã€‚æˆ‘ä»¬æœ€å¼€å§‹å…ˆå¯’æš„äº†ä¸€æ³¢ï¼Œæåˆ°æˆ‘åœ¨ä¸­å›½çš„æ—¶å€™ï¼Œå¥¹è¿˜å…´è‡´ç›ç„¶åœ°åˆ†äº«äº†è‡ªå·±å»ä¸­å›½æ—…æ¸¸çš„ç»å†ã€‚å¥¹å»è¿‡çš„åœ°æ–¹è¿˜çœŸä¸å°‘ï¼ŒåŒ—äº¬ï¼Œæˆéƒ½ï¼Œä¸Šæµ·ä»€ä¹ˆçš„éƒ½å»è¿‡ï¼Œæ„Ÿè§‰æŒºæœ‰æ„æ€çš„ã€‚åé¢æ„Ÿè§‰å°±è‡ªç„¶å¤šäº†ï¼ŒåŸºæœ¬ä¸ŠæŒ‰ç…§æçº²ä¸€é—®ä¸€ç­”ï¼Œæˆ‘è¿˜ä¸´æ—¶å‘æŒ¥äº†ä¸å°‘ï¼Œæœ€åé‡‡è®¿å°±åœ¨ä¸€ç‰‡æ¬¢å£°ç¬‘è¯­ä¸­ç»“æŸäº†ã€‚

è¿™æ¬¡é‡‡è®¿çš„å‡ ä¸ªæ„Ÿæƒ³ï¼š

- æ„Ÿè°¢å¥³æœ‹å‹ä¸€ç›´æ‹‰ç€æˆ‘çœ‹è‹±ç¾å‰§ï¼Œæ„Ÿè§‰è‡ªå·±è¯´èµ·è¯æ¥æ²¡æœ‰é‚£ä¹ˆåƒµç¡¬ã€‚
- å¬ä¸å¬å¾—æ‡‚æ˜¯åˆ«äººçš„äº‹æƒ…ï¼Œå¼ ä¸å¼ å£æ˜¯è‡ªå·±çš„äº‹æƒ…ã€‚åªè¦æ•¢è¯´ï¼Œé—®é¢˜å°±è§£å†³äº†ä¸€å¤§åŠï¼Œè¯­æ³•å•Šï¼Œå‘éŸ³å•Šï¼Œå’¬å­—å•Šéƒ½æ˜¯å°é—®é¢˜ï¼ŒçœŸæ­£çš„å£å¤´äº¤æµæ²¡äººä¼šé—²ç€æ²¡äº‹å¹²çº æ­£ä½ çš„å‘éŸ³é—®é¢˜ã€‚
- æ„Ÿè§‰è¯­éŸ³äº¤æµå¾ˆæœ‰æ„æ€ï¼Œä»¥åå¸Œæœ›èƒ½å¤šå‚åŠ ä¸€äº›ç±»ä¼¼çš„è®¿è°ˆèŠ‚ç›®ï¼Œå…å¾—è‡ªå·±é•¿æœŸåœ¨å®¶è¯­è¨€æ²Ÿé€šèƒ½åŠ›é€€åŒ–ã€‚

## Fusebot é€€ä¼‘

Databend è¿‡å»ä½¿ç”¨ [fusebot](https://github.com/datafuselabs/fusebots) æ¥å®Œæˆå„ç§è‡ªåŠ¨åŒ–æ“ä½œï¼Œæ¯”å¦‚ Nightly Releaseï¼ŒAuto Label å’Œ Auto Mergeã€‚ä½†æ˜¯ç»´æŠ¤è¿™æ ·ä¸€ä¸ªè‡ªåŠ¨åŒ–çš„ bot æ˜¯ä¸€ä»¶å¾ˆæ— èŠçš„äº‹æƒ…ï¼šç®€å•çš„äº‹æƒ…ä¸ç”¨å®ƒä¹Ÿèƒ½æå®šï¼Œéº»çƒ¦çš„äº‹æƒ…å®ç°èµ·æ¥å¾ˆè´¹åŠ²ã€‚æ‰€ä»¥åæ¥æˆ‘ä»¬å†³å®šå°½å¯èƒ½ä½¿ç”¨ç°æˆçš„ SaaS æœåŠ¡æ¥è§£å†³è¿™äº›éœ€æ±‚ï¼Œä¸å†è‡ªå·±é‡å¤é€ æ²¡æœ‰æ„ä¹‰çš„è½®å­ã€‚æ­£å¦‚å‰é¢æ‰€æåˆ°çš„ï¼ŒMerfigy å·²ç»é€æ­¥å–ä»£äº† fusebot çš„åŠŸèƒ½ï¼Œè·ç¦»å½»åº•æ›¿ä»£åªå·®ä¸€ä¸ª Nightly Release è‡ªåŠ¨åˆ›å»ºã€‚

ä¸ºäº†å®Œå–„æ•´ä¸ª Release çš„æµç¨‹ï¼Œæˆ‘å‘èµ·äº† [proposal: Semantic Release](https://github.com/datafuselabs/databend/discussions/6383)ï¼Œä¸»è¦å˜åŒ–æœ‰ä¸¤å¤„ï¼š

- å¼•å…¥ Semantic PRï¼Œè¦æ±‚ PR çš„æ ‡é¢˜å¿…é¡»ç¬¦åˆè¯­ä¹‰åŒ–çš„è¦æ±‚ï¼ˆè¿‡å»æˆ‘ä»¬æ˜¯è¦æ±‚å¼€å‘è€…åœ¨ PR çš„æè¿°ä¸­å¡«å†™ç›¸å…³çš„é¡¹ç›®ï¼‰
- ä½¿ç”¨ Github åŸç”Ÿçš„ Release Notes ç”Ÿæˆæœºåˆ¶ï¼Œå»æ‰å¯¹ Fusebot çš„ä¾èµ–

Semantic PR åŸºæœ¬ä¸Šå°±æ˜¯ [Conventional Commits](https://www.conventionalcommits.org/en/v1.0.0/) çš„ PR ç‰ˆæœ¬ï¼Œæˆ‘ä»¬é€šè¿‡ Merfigy çš„ PR Action æ¥å¼ºåˆ¶è¦æ±‚å¼€å‘è€…å¿…é¡»ä½¿ç”¨åˆæ³•çš„ PR typesã€‚ä¸ç¬¦åˆè¦æ±‚çš„è¯ï¼ŒMerfigy ä¼š comment PR è¦æ±‚ä¿®æ”¹ï¼š

![](comment.png)

åœ¨è¿™ä¸ªåŸºç¡€ä¸Šï¼ŒMerfigy å¯ä»¥è‡ªåŠ¨çš„ä¸º PR å¢åŠ å¯¹åº”çš„æ ‡ç­¾ã€‚ç„¶åå°±å¯ä»¥ä½¿ç”¨ Github åŸç”Ÿçš„ Release Notes ç”Ÿæˆæœºåˆ¶æ¥é…ç½®ï¼Œåªéœ€è¦å¢åŠ ä¸€ä¸ªé…ç½®æ–‡ä»¶ `.github/release.yml` å³å¯

```yaml
changelog:
  exclude:
    labels:
      - pr-chore
    authors:
      - Mergify
  categories:
    - title: Exciting New Features âœ¨
      labels:
        - pr-feature
    - title: Thoughtful Bug Fix ğŸ”§
      labels:
        - pr-bugfix
    - title: Code Refactor ğŸ‰
      labels:
        - pr-refactor
    - title: Build/Testing/CI Infra Changes ğŸ”Œ
      labels:
        - pr-build
    - title: Documentation ğŸ“”
      labels:
        - pr-doc
```

è¿™é‡Œè¿˜æœ‰ä¸€äº›å…³äº `gh` çš„å°æŠ€å·§ï¼šæ£€æŸ¥æœ€æ–° release å’Œåˆ›å»º release ç›¸å…³çš„ action éƒ½ä¸æ˜¯ç‰¹åˆ«å¥½ç”¨ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ runner ä¸­è‡ªå¸¦çš„ `gh` å‘½ä»¤æ¥æå®šã€‚

è·å–å½“å‰æœ€æ–°çš„ release tag ï¼ˆæ³¨æ„è·Ÿ git tag çš„è¾“å‡ºæ˜¯ä¸åŒçš„ï¼‰

```yaml
- name: Get latest tag
  id: get-latest-tag
  run: |
    echo "::set-output name=tag::`gh release list -L 1 | cut -f 1`"
  env:
    GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}
```

åˆ›å»º releaseï¼š

```yaml
- name: Create github release if not exist
  # Reference: https://cli.github.com/manual/gh_release_create
  run: |
    echo "Create a release for ${{ steps.generated-tag.outputs.tag }}"
    gh release create ${{ steps.generated-tag.outputs.tag }} --generate-notes -p
  env:
    GH_TOKEN: ${{ secrets.GITHUB_TOKEN }}

```

- `--generate-notes` ç”¨äºè®© Github è‡ªåŠ¨ç”Ÿæˆ Release Note
- `-p` ç”¨æ¥æŠŠå½“å‰ release æ ‡è®°ä¸º `prerelease`

åç»­åªéœ€è¦ä½¿ç”¨ç›¸åŒçš„ tag æ¥ä¸Šä¼ å³å¯ï¼š

```yaml
- name: Update release to github
  shell: bash
  # Reference: https://cli.github.com/manual/gh_release_upload
  run: gh release upload ${{ inputs.version }} databend-${{ inputs.version }}-${{ inputs.target }}.* --clobber
  env:
    GH_TOKEN: ${{ inputs.github_token }}
```

ç›´æ¥ä½¿ç”¨ `gh` æ¯”å¼•å…¥ä¸€å † aciton è¦æ–¹ä¾¿çš„å¤šï¼Œå®Œæ•´çš„ workflow å‚è§ [databend-release.yml](https://github.com/datafuselabs/databend/blob/main/.github/workflows/databend-release.yml)ã€‚

---

è¿™ä¸ªå‘¨æœŸæ¯”è¾ƒæœ‰æ„æ€çš„äº‹æƒ…å°±è¿™äº›ï¼Œæˆ‘ä»¬ä¸‹å‘¨å†è§ï½
