<!doctype html><html><head><title>Tiresias —— 服务器信息管理工具</title><meta charset=utf-8><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta name=description content="A blog maintained by an interesting programmer."><meta name=keywords content=Technology,Code,Program,Linux,><meta name=author content=Xuanwo><meta property=og:title content="Tiresias —— 服务器信息管理工具"><meta property=og:description content="A blog maintained by an interesting programmer."><meta property=og:type content=website><meta property=og:locale content=en_US><meta property=og:url content=https://xuanwo.io/2018/05/22/tiresias-intro/><link href rel=alternate type=application/rss+xml title="Xuanwo's Blog"><link rel="shortcut icon" href=/favicon.ico><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/normalize.css@8.0.0/normalize.min.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/milligram@1.3.0/dist/milligram.min.css integrity="sha256-Ro/wP8uUi8LR71kwIdilf78atpu8bTEwrK5ZotZo+Zc=" crossorigin=anonymous><link rel=stylesheet href=/css/main.min.css><link href=http://gmpg.org/xfn/11 rel=profile><meta name=generator content="Hugo 0.54.0"></head><body><div id=container><header id=header><div id=header-outer class=outer><div id=header-inner class=inner><a id=main-nav-toggle class=nav-icon href=javascript:;><svg width="1em" height="1em" viewBox="0 0 100 100"><use xlink:href="/svg/fontawesome.svg#bars"/></svg></a><a id=logo class=logo-text href=https://xuanwo.io>Xuanwo&#39;s Blog</a><nav id=main-nav><a class=main-nav-link href=/categories/>分类</a>
<a class=main-nav-link href=/tags/>标签</a>
<a class=main-nav-link href=/series/>专题</a>
<a class=main-nav-link href=/blogroll/>友链</a>
<a class=main-nav-link href=/index.xml>订阅</a>
<a class=main-nav-link href=/about/>关于我</a></nav></div></div></header><section id=main class=outer><article class="article article-type-post" itemscope itemprop=blogPost><div class=article-inner><header class=article-header><h1 class=article-title itemprop=name>Tiresias —— 服务器信息管理工具</h1></header><div class=article-meta><a href=/2018/05/22/tiresias-intro/ class=article-date><time datetime=2018-05-22T04:00:00.000&#43;00:00 itemprop=datePublished>2018-05-22</time></a><div class=post-categories><div class=article-category><a class=article-category-link href=https://xuanwo.io/categories/code>Code</a></div></div><div class=article-comment-link-wrap><a href=/2018/05/22/tiresias-intro/#disqus_thread class=article-comment-link>Comments</a></div></div><div class=article-entry itemprop=articleBody><blockquote><p>本文是
<a href=https://xuanwo.io/series/self-made-wheels>Self-made Wheels</a> 系列的第 2 篇文章, 共 4 篇。</p></blockquote><p>大概从大二的时候开始就有这种困惑：不同的服务器所在的云服务商，数据中心，网段，用户名和私钥各不相同，他们的信息要如何管理？最开始是把所有的服务器信息都存放在了密码管理工具当中，后来知道了使用 <a href=https://github.com/moul/advanced-ssh-config>assh</a> 来生成 <code>ssh_config</code>，最后是 <a href=https://pjw.io/>@Aspire</a> 提供的一个思路：使用脚本生成 <code>hosts</code> 文件。于是我顺着 Aspire 的思路开发了一个工具：<a href=https://github.com/Xuanwo/tiresias>Tiresias</a>，它可以读取事先写好的 YAML 配置文件并生成 <code>ssh_config</code> 和 <code>hosts</code> 文件。今天这篇文章就主要介绍一下我造的又一个轮子。</p><h2 id=介绍>介绍</h2><p>Tiresias，一般翻译为<a href=https://zh.wikipedia.org/wiki/%E7%89%B9%E4%BC%8A%E8%A5%BF%E4%BA%9A%E6%96%AF>特伊西亚斯</a>，古希腊神话人物，是一位盲人先知，凭借多种获得信息的能力并对世界进行解释而闻名于世。这个工具取这个名字主要就是采用了盲人先知的意象，希望它可以更好帮助管理众多服务器的信息。</p><h2 id=使用>使用</h2><p>Tiresias 不需要特别的安装过程，只需要从 <a href=https://github.com/Xuanwo/tiresias/releases>release</a> 处下载编译好的二进制即可使用。</p><p>Tiresias 运行时需要指定一个配置文件，比如：</p><div class=highlight><pre style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml>src:<span style=color:#bbb>
</span><span style=color:#bbb>  </span>-<span style=color:#bbb> </span>type:<span style=color:#bbb> </span>fs<span style=color:#bbb>
</span><span style=color:#bbb>    </span>path:<span style=color:#bbb> </span>/path/to/source/file<span style=color:#bbb>
</span><span style=color:#bbb>
</span><span style=color:#bbb></span>dst:<span style=color:#bbb>
</span><span style=color:#bbb>  </span>-<span style=color:#bbb> </span>type:<span style=color:#bbb> </span>ssh_config<span style=color:#bbb>
</span><span style=color:#bbb>    </span>path:<span style=color:#bbb> </span>/home/xuanwo/.ssh/config<span style=color:#bbb>
</span><span style=color:#bbb>  </span>-<span style=color:#bbb> </span>type:<span style=color:#bbb> </span>hosts<span style=color:#bbb>
</span><span style=color:#bbb>    </span>path:<span style=color:#bbb> </span>/etc/hosts</code></pre></div><p><code>src</code> 目前支持 <code>fs</code> 类型，可以指向一个 yaml 配置文件：</p><div class=highlight><pre style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=color:#60a0b0;font-style:italic># production server</span><span style=color:#bbb>
</span><span style=color:#bbb></span>-<span style=color:#bbb> </span>name:<span style=color:#bbb> </span>production-server<span style=color:#bbb>
</span><span style=color:#bbb>  </span>address:<span style=color:#bbb> </span><span style=color:#40a070>1.1</span>.<span style=color:#40a070>1.1</span><span style=color:#bbb>
</span><span style=color:#bbb>  </span>user:<span style=color:#bbb> </span>root<span style=color:#bbb>
</span><span style=color:#bbb>  </span>identity_file:<span style=color:#bbb> </span>~/.ssh/private_key<span style=color:#bbb>
</span><span style=color:#bbb></span><span style=color:#60a0b0;font-style:italic># staging server</span><span style=color:#bbb>
</span><span style=color:#bbb></span>-<span style=color:#bbb> </span>name:<span style=color:#bbb> </span>staging-server<span style=color:#bbb>
</span><span style=color:#bbb>  </span>address:<span style=color:#bbb> </span><span style=color:#40a070>2.2</span>.<span style=color:#40a070>2.2</span><span style=color:#bbb>
</span><span style=color:#bbb>  </span>user:<span style=color:#bbb> </span>root<span style=color:#bbb>
</span><span style=color:#bbb>  </span>identity_file:<span style=color:#bbb> </span>~/.ssh/private_key</code></pre></div><p><code>dst</code> 目前支持 <code>ssh_config</code> 和 <code>hosts</code> 类型，可以通过 path 指定生成文件的地址。以刚才的输入为例，将会分别生成如下两个文件：</p><div class=highlight><pre style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-ssh_config data-lang=ssh_config># -- Generated by tiresias at 2018-05-22 13:35:35.669119377 +0800 CST m=+0.002915397 --
Host production-server
    HostName 1.1.1.1
    User root
    IdentityFile ~/.ssh/private_key

Host staging-server
    HostName 2.2.2.2
    User root
    IdentityFile ~/.ssh/private_key</code></pre></div><div class=highlight><pre style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-hosts data-lang=hosts># -- Generated by tiresias at 2018-05-22 13:35:35.669429758 +0800 CST m=+0.003225739 --
1.1.1.1 production-server
2.2.2.2 staging-server</code></pre></div><p>配合上 shell 提供的自动补全功能，我们就可以这样使用了：</p><div class=highlight><pre style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ ping production-server
$ ssh staging-server
$ redis-cli -h production-server
$ mysql -h staging-server -u root -p</code></pre></div><h2 id=实现>实现</h2><p><code>Tiresias</code> 实现上并不复杂，分别定义了 <code>Source</code> 和 <code>Destnation</code> 两个 interface，然后从 Source 读取数据并写入到 Destnation。</p><h2 id=展望>展望</h2><ul><li>配合 systemd.path 或者 inotify 可以实现文件变更之后的自动更新</li><li>支持从更多的 Source 中读取数据，比如一个 url，etcd 或者是 Keyring</li><li>支持向更多的 Destnation 中写入数据，比如写入到 Keyring 或者密码管理器</li><li>支持 Server name 的通配符以支持配置批量服务器</li></ul><h2 id=总结>总结</h2><p><code>Tiresias</code> 以一种非侵入式的方式实现了服务器信息的管理和应用，使得用户只需要维护一个固定的源就能方便快捷的维护自己的所有服务器，不会产生任何非预期的行为。</p><h2 id=动态>动态</h2><ul><li>上个周末一直在看 MSI，时隔三年，LPL 终于再一次拿到了 MSI 的冠军。小狗牛逼，RNG 牛逼，LPL 牛逼！</li><li>MSI 决赛的第三局 Letme 的一手剑来，让我又想再把 《雪中悍刀行》再看一遍了</li><li>据说隔壁 Dota 2 项目也得了冠军，西恩军团牛逼！</li><li>为了庆祝 RNG MSI 夺冠，昨天请好朋友一起吃了日本料理，Excited ！</li></ul></div><div class=article-toc></div><footer class=article-footer><ul class=article-tag-list><li class=article-tag-list-item><a class=article-tag-list-link href=https://xuanwo.io/tags/golang>Golang</a></li><li class=article-tag-list-item><a class=article-tag-list-link href=https://xuanwo.io/tags/ssh>SSH</a></li></ul></footer></div><nav id=article-nav><a href=/2018/06/15/bug-caused-by-misreading/ id=article-nav-newer class=article-nav-link-wrap><div class=article-nav-title><span>&lt;</span>&nbsp;
文档误读导致的 BUG</div></a><a href=/2018/05/16/thinkpad-x1-carbon-6th/ id=article-nav-older class=article-nav-link-wrap><div class=article-nav-title>ThinkPad X1 Carbon 2018 开箱手记&nbsp;<span>&gt;</span></div></a></nav></article><div id=disqus_thread></div><script type=application/javascript>var disqus_config=function(){this.page.identifier='\/2018\/05\/22\/tiresias-intro\/';this.page.title='Tiresias —— 服务器信息管理工具';this.page.url='https:\/\/xuanwo.io\/2018\/05\/22\/tiresias-intro\/';};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById('disqus_thread').innerHTML='Disqus comments not available by default when the website is previewed locally.';return;}
var d=document,s=d.createElement('script');s.async=true;s.src='//'+"only0god"+'.disqus.com/embed.js';s.setAttribute('data-timestamp',+new Date());(d.head||d.body).appendChild(s);})();</script><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></section><footer id=footer><div class=outer><div id=footer-info class=inner>&copy; 2019 Xuanwo&#39;s Blog&nbsp;
Powered by <a href=https://gohugo.io target=_blank>Hugo</a></div></div><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-51515330-1','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script src=https://cdn.jsdelivr.net/npm/tocbot@4/dist/tocbot.min.js></script><script>tocbot.init({tocSelector:'.article-toc',contentSelector:'.article-entry',headingSelector:'h1, h2, h3, h4, h5',});</script><script>document.getElementById('main-nav-toggle').addEventListener('click',function(){var header=document.getElementById('header');if(header.classList.contains('mobile-on')){header.classList.remove('mobile-on');}else{header.classList.add('mobile-on');}});</script></footer></div></body></html>