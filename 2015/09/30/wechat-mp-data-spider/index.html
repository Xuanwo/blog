<!doctype html><html><head><title>微信公众平台数据抓取解决方案</title><meta charset=utf-8><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta name=description content="A blog maintained by an interesting programmer."><meta name=keywords content="Technology,Code,Program,Linux,"><meta name=author content="Xuanwo"><meta property="og:title" content="微信公众平台数据抓取解决方案"><meta property="og:description" content="A blog maintained by an interesting programmer."><meta property="og:type" content="website"><meta property="og:locale" content="en_US"><meta property="og:url" content="https://xuanwo.io/2015/09/30/wechat-mp-data-spider/"><link rel="shortcut icon" href=/favicon.ico><link rel=stylesheet href=https://xuanwo.io/css/main.min.5a9ffcf343273240b691845bba645faa19f2008c05742711b684042a3063818b.css integrity="sha256-Wp/880MnMkC2kYRbumRfqhnyAIwFdCcRtoQEKjBjgYs="><script data-ad-client=ca-pub-8380875817494486 async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script><link href=http://gmpg.org/xfn/11 rel=profile><meta name=generator content="Hugo 0.68.3"></head><body><nav class=nav><div class=nav-container><div class=brand><a href=https://xuanwo.io>Xuanwo's Blog</a></div><div class=links><a class=main-nav-link href=/about/>About</a>
<a class=main-nav-link href=/posts/>Posts</a></div></div></nav><main id=main-content><article class="single container"><header class=single-header><div class=flex><h1>微信公众平台数据抓取解决方案</h1><div class=post-meta><time class=date datetime=2015-09-30T10:12:58.000+00:00 itemprop=datePublished>2015-09-30</time></div><div class=tag-container><a style=text-decoration:none href=https://xuanwo.io/tags/qingcloud><span>QingCloud</span></a>
<a style=text-decoration:none href=https://xuanwo.io/tags/work><span>Work</span></a></div></div></header><div class=post><p>有一个需求是将微信公众平台的数据导出到Excel以进行后续的数据分析。在关注人数等数据上，微信已经提供了Excel导出的接口，但是在图文分析上，尽管有很详细的数据提供，却没有提供一个好的导出接口。所以我需要寻求一个简单的方案来抓取微信公众平台的图文分析数据。</p><h1 id=分析>分析</h1><p>图文分析页面是JS加载的，通过后台提交返回数据，然后使用JS渲染生成页面。对着页面分析了一会儿，没有发现比较简单的请求构造方式，但是发现微信给出的数据形式非常有规律，可以采用正则来获取我想要的信息。</p><h1 id=方案>方案</h1><h2 id=适用范围>适用范围</h2><ul><li>单页</li><li>批量</li><li>规则数据</li></ul><h2 id=工具>工具</h2><ul><li>Chrome</li><li>Sublime Text 3</li><li>Excel 2016</li></ul><h2 id=流程>流程</h2><ul><li>使用Chrome访问相关页面，列出公众号指定时段的所有图文消息</li><li><code>Ctrl+A</code>大法，选中所有数据并保存到Sublime中</li><li>运用正则批量处理之</li><li>导入到Excel</li></ul><h1 id=坑点>坑点</h1><h2 id=微信公众平台bug>微信公众平台BUG</h2><p>微信公众平台的图文分析的排序规则上有着很明显的BUG，比如按照发表时间排序，但是并不是所有文章都是按照时间排序的。不过这个BUG并不是非常大，输出到Excel之后排序更快更好。
除此之外，当选择的时间跨度比较大的时候，还有一定概率会出现错误。这个没有做复现，所以没有进行进一步的分析。</p><h2 id=分隔符的选择>分隔符的选择</h2><p>在本次正则的处理中，我使用了<code>|</code>作为分隔符，但是坑爹之处在于，公众平台的文章标题中，有一部分也使用了<code>|</code>这个符号。导致最后生成的数据中出现了部分标题被分隔为两端的现象，幸好数据不多，自己手动Fix了。</p><h1 id=总结>总结</h1><p>经过多次数据抓取的实战，对于前期的分析以及抓取流程已经非常娴熟，但是在后期的数据处理过程中，仍然有着比较大的问题。一个比较明显的问题就是对于数据的特征把握不全面，经常出现所有数据处理完才发现数据中某个特定的值导致批量处理的结果不符合预期。所以以后处理数据时要注意对数据特征的全面把握，不要依赖后期自己的手动Fix。</p><h1 id=更新日志>更新日志</h1><ul><li>2015年09月30日 完成初稿</li></ul></div><div id=gitalk-container><div class=gt-container><div class=gt-meta><span class=gt-counts>6 comments</span></div><div class=gt-header><a class=gt-avatar-github><span class="gt-avatar gt-comment-avatar"><img src=https://www.gravatar.com/avatar/></span></a><div class=gt-header-comment><form class=gt-header-form target=comment-iframe method=post action=https://gitqus.now.sh/v0/comments/github.com/Xuanwo/xuanwo.github.io/master><input type=hidden name=slug value=/2015/09/30/wechat-mp-data-spider/>
<input class=gt-header-input type=text name=name placeholder=Name required>
<input class=gt-header-input type=email name=email placeholder=Email required>
<textarea class=gt-header-textarea name=content placeholder="Leave a comment"></textarea><div class=gt-header-controls><button class=gt-btn><span class=gt-btn-text>Submit</span></button></div><iframe name=comment-iframe hidden id=frame></iframe></form></div></div><div class=gt-comments><div class="gt-comment gt-comment-admin"><div class="gt-avatar gt-comment-avatar"><img src=https://www.gravatar.com/avatar/></div><div class=gt-comment-content><div class=gt-comment-header><a class=gt-comment-username href=https://github.com/booxood>漩涡</a>
<span class=gt-comment-text>commented</span>
<span class=gt-comment-date>2016-01-10T14:10:49</span></div><div class="gt-comment-body markdown-body">唔。。我只会上述特定场景的- -，简单地说，我会的我都分享出来了，没有写的就是都不会了= =</div></div></div><div class="gt-comment gt-comment-admin"><div class="gt-avatar gt-comment-avatar"><img src=https://www.gravatar.com/avatar/></div><div class=gt-comment-content><div class=gt-comment-header><a class=gt-comment-username href=https://github.com/booxood>cxlcym</a>
<span class=gt-comment-text>commented</span>
<span class=gt-comment-date>2016-01-10T13:53:01</span></div><div class="gt-comment-body markdown-body">公众平台</div></div></div><div class="gt-comment gt-comment-admin"><div class="gt-avatar gt-comment-avatar"><img src=https://www.gravatar.com/avatar/></div><div class=gt-comment-content><div class=gt-comment-header><a class=gt-comment-username href=https://github.com/booxood>漩涡</a>
<span class=gt-comment-text>commented</span>
<span class=gt-comment-date>2016-01-10T12:57:32</span></div><div class="gt-comment-body markdown-body">微信的抓取不太懂唉</div></div></div><div class="gt-comment gt-comment-admin"><div class="gt-avatar gt-comment-avatar"><img src=https://www.gravatar.com/avatar/></div><div class=gt-comment-content><div class=gt-comment-header><a class=gt-comment-username href=https://github.com/booxood>cxlcym</a>
<span class=gt-comment-text>commented</span>
<span class=gt-comment-date>2016-01-10T11:43:29</span></div><div class="gt-comment-body markdown-body">您好，求助下微信的抓取，能帮忙么？论文数据不会抓取&mldr;.. 能说下联系方式不</div></div></div><div class="gt-comment gt-comment-admin"><div class="gt-avatar gt-comment-avatar"><img src=https://www.gravatar.com/avatar/></div><div class=gt-comment-content><div class=gt-comment-header><a class=gt-comment-username href=https://github.com/booxood>漩涡</a>
<span class=gt-comment-text>commented</span>
<span class=gt-comment-date>2015-10-06T16:02:29</span></div><div class="gt-comment-body markdown-body">自己修改了部分CSS</div></div></div><div class="gt-comment gt-comment-admin"><div class="gt-avatar gt-comment-avatar"><img src=https://www.gravatar.com/avatar/></div><div class=gt-comment-content><div class=gt-comment-header><a class=gt-comment-username href=https://github.com/booxood>Haoming Wang</a>
<span class=gt-comment-text>commented</span>
<span class=gt-comment-date>2015-10-06T15:41:31</span></div><div class="gt-comment-body markdown-body">你好， 你的主题很好看，但是和官网上的不太一样， 请问你是怎么设置的呢？</div></div></div></div></div></div></article></main><footer class="footer container"><a class=main-nav-link href=/categories/>Categories</a>
<a class=main-nav-link href=/tags/>Tags</a>
<a class=main-nav-link href=/series/>Series</a>
<a class=main-nav-link href=/blogroll/>Blogroll</a>
<a class=main-nav-link href=/index.xml>Subscribe</a>
<script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-51515330-1','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script></footer></body></html>