<!doctype html><html><head><title>翻车实况第 1 期</title><meta charset=utf-8><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta name=description content="A blog maintained by an interesting programmer."><meta name=keywords content=Technology,Code,Program,Linux,><meta name=author content=Xuanwo><meta property=og:title content="翻车实况第 1 期"><meta property=og:description content="A blog maintained by an interesting programmer."><meta property=og:type content=website><meta property=og:locale content=en_US><meta property=og:url content=https://xuanwo.io/2019/02/19/rollover-1st/><link rel="shortcut icon" href=/favicon.ico><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/normalize.css@8.0.0/normalize.min.css><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/milligram@1.3.0/dist/milligram.min.css integrity="sha256-Ro/wP8uUi8LR71kwIdilf78atpu8bTEwrK5ZotZo+Zc=" crossorigin=anonymous><link rel=stylesheet href=/css/main.min.css><link href=http://gmpg.org/xfn/11 rel=profile><meta name=generator content="Hugo 0.55.6"></head><body><div id=container><header id=header><div id=header-outer class=outer><div id=header-inner class=inner><a id=main-nav-toggle class=nav-icon href=javascript:;><svg width="1em" height="1em" viewBox="0 0 100 100"><use xlink:href="/svg/fontawesome.svg#bars"/></svg></a><a id=logo class=logo-text href=https://xuanwo.io>Xuanwo&#39;s Blog</a><nav id=main-nav><a class=main-nav-link href=/categories/>分类</a>
<a class=main-nav-link href=/tags/>标签</a>
<a class=main-nav-link href=/series/>专题</a>
<a class=main-nav-link href=/blogroll/>友链</a>
<a class=main-nav-link href=/index.xml>订阅</a>
<a class=main-nav-link href=/about/>关于我</a></nav></div></div></header><section id=main class=outer><article class="article article-type-post" itemscope itemprop=blogPost><div class=article-inner><header class=article-header><h1 class=article-title itemprop=name>翻车实况第 1 期</h1></header><div class=article-meta><a href=/2019/02/19/rollover-1st/ class=article-date><time datetime=2019-02-19T06:00:00.000&#43;00:00 itemprop=datePublished>2019-02-19</time></a><div class=post-categories><div class=article-category><a class=article-category-link href=https://xuanwo.io/categories/daily>Daily</a></div></div><div class=article-comment-link-wrap><a href=/2019/02/19/rollover-1st/#disqus_thread class=article-comment-link>Comments</a></div></div><div class=article-entry itemprop=articleBody><blockquote><p>本文是
<a href=https://xuanwo.io/series/rollover-live>Rollover Live</a> 系列的第 1 篇文章, 共 2 篇。</p></blockquote><blockquote><p>今天翻车了吗？翻了！</p></blockquote><p>本次翻车的主角是我小老婆：ThinkPad X1 Carbon，在之前的<a href=https://xuanwo.io/2018/05/16/thinkpad-x1-carbon-6th/>开箱手记</a>曾经爆过照片。用了几个月都没有什么太大的问题，但是自从我春节回家一趟之后，我的 x1 开始了它的频频翻车之旅 = =</p><h2 id=大江苏魔法伤害>大江苏魔法伤害</h2><p>春节回家之后，电脑就一直放在透气性不大好的背包里面。拿出来的时候发现整个电脑的表面都有一层薄薄的水汽，甚至还能找到一点微妙的水墨画的感觉：</p><p><img src=water.jpg alt></p><p>想着 ThinkPad 种种键盘洒水问题不大的传说，我完全没有把这点水汽当回事。打开电脑，连上网络，<code>yay</code> 一把梭。发现内核升级了，随手重启一下，结果翻车了：</p><p><img src=failed-to-start.jpg alt></p><p>这还是我第一次遇到这样的问题，从报错上来看应该跟我的更新没有关系，可能是硬盘有了一些奇怪的问题，中间有些 IO 全部失败了，导致好多服务都起不来了。虽然觉得纳闷，但是还是觉得先重启一下看看，确认一下是否稳定复现。结果问题更加严重了，在滴的一声之后，我的电脑完全没有引导，直接进入了空白的 Boot Menu 页：</p><p><img src=empty-boot.jpg alt></p><p>噫，这是我整个硬盘都挂掉了的节奏啊。当我准备掏出 archiso 看看还没有救的时候，有人找我有事情，于是我把电脑合上走开了。半个小时回来之后，按下电源键，电脑居然直接正常启动了 = =，我拿着 U 盘一脸懵逼。发生了什么？难道刚才启动不了是因为在启动的一瞬间，硬盘进入了量子态？放置 play 了一会儿之后，它又自己回来了？薛定谔的硬盘？？？</p><p>稍微琢磨了一下之后，把问题归咎于江苏水汽比较重，电脑长期放在包里面，导致里面的某些部件出现了问题，在开放环境放了一会儿之后就自己好了。（不管你信不信，反正我信了）</p><h2 id=帝都的静电攻击>帝都的静电攻击</h2><p>我天真的以为翻车事件已经结束了，然而轮胎打滑通常只是真正车祸的前奏（</p><p>返工的第二天，我普通的起床、普通的上班、普通的进入办公室、普通的坐下、普通的升级系统、普通的重启、普通的接上显示器，普通的，等一下！我的显示器咋不亮了！在那一瞬间，我的大脑瞬间渲染出无数剧情： <em>电脑坏了，送去维修，错过用户大单，被公司开除，孤单一人行走在冬夜空档的大街上，发誓再也不滚系统了。。。</em></p><p>摇摇头，开始仔细研究发生了什么。</p><p>显卡是 Intel 提供的集成显卡，驱动用的是 Kernel Mode Setting。正常情况下如果我接上了外接显示器，kernel 会响应并接管这个设备的显示，就像下面这个图一样：</p><p><img src=kms.svg alt></p><p>每个显示输出设备的连接状态都会都会保存为一个形如 <code>/sys/class/drm/card0-HDMI-A-1/status</code> 的文件，archwiki 上提供了一个命令来查看电脑上所有输出设备的状态：</p><div class=highlight><pre style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-bash data-lang=bash>$ <span style=color:#007020;font-weight:700>for</span> p in /sys/class/drm/*/status; <span style=color:#007020;font-weight:700>do</span> <span style=color:#bb60d5>con</span><span style=color:#666>=</span><span style=color:#70a0d0;font-style:italic>${</span><span style=color:#bb60d5>p</span>%/status<span style=color:#70a0d0;font-style:italic>}</span>; <span style=color:#007020>echo</span> -n <span style=color:#4070a0>&#34;</span><span style=color:#70a0d0;font-style:italic>${</span><span style=color:#bb60d5>con</span>#*/card?-<span style=color:#70a0d0;font-style:italic>}</span><span style=color:#4070a0>: &#34;</span>; cat <span style=color:#bb60d5>$p</span>; <span style=color:#007020;font-weight:700>done</span>
DP-1: disconnected
DP-2: disconnected
eDP-1: connected
HDMI-A-1: disconnected
HDMI-A-2: disconnected</code></pre></div><p>可以看出来，除了内置的显示屏 <code>eDP-1</code> 没问题之外，其他的接口都是断开状态的，尽管我的线已经接上去了。噫，照这么看，我的 HDMI 和 Type-C 口都凉了啊，难道只能送修了么？</p><p>不要放弃治疗，可能是显示器坏了呢！我把同事的电脑拿过来插上发现没有问题；而我的电脑接他的显示器则同样是显示不出来。凉了？不，我还不能就这样放弃治疗，说不定是底裤 D 升级的时候又搞崩了什么东西呢？我选择回滚了一波 systemd，重启，奇迹没有发生。说不定是内核有问题呢？我选择回滚了一波内核，重启，奇迹仍然没有发生。我叹了口气，果然，玄学是不存在的，我的电脑凉了。</p><p>我都已经放弃治疗准备送修了，我的朋友 P 坚持让我搞个 PE 什么的看看，说不定接口还没坏。反正也不差那么几分钟，为了让我朋友，更为了让我自己死心，我觉得再进行最后一次尝试。我掏出了我的 Archiso 插上，开机，插上 HDMI 线，卧槽，显示器亮了！接口没坏！</p><p>这可真是<code>踏破铁鞋无觅处，柳暗花明又一村</code>，我感到自己的人生再次充满了希望，我的大脑中再次闪过无数画面：<em>电脑修好了，完成了后端大规模重构，性能提升 150%，成为了年度优秀员工，找到了三次元老婆，走向人生巅峰。。。</em></p><p>咳咳咳，冷静。现在的情况是已经排除了是硬件问题，我决定通过 Archlinux Rollback Machine 把电脑回滚到昨天。拔掉 U 盘，开机，我鬼使神差的把线直接接到了电脑上，卧槽，显示器亮了！所以说，既不是硬件问题，也不是软件问题？那还能是啥问题，人品问题么？</p><p>emmmmmm，仔细想了一下，我觉得不如解释成静电问题，插上 USB 的时候释放掉了机器内部的静电，然后所有的接口都恢复正常了。（不管你信不信，反正我是真的信了）</p><h2 id=后记>后记</h2><p>以上就是本次的翻车实录~</p><h2 id=引用资料>引用资料</h2><ul><li><a href=https://www.kernel.org/doc/html/v4.15/gpu/drm-kms.html>Kernel Mode Setting (KMS)</a></li><li><a href=https://wiki.archlinux.org/index.php/kernel_mode_setting#Forcing_modes>Kernel mode setting - Archwiki</a></li></ul></div><div class=article-toc></div><footer class=article-footer><ul class=article-tag-list><li class=article-tag-list-item><a class=article-tag-list-link href=https://xuanwo.io/tags/archlinux>Archlinux</a></li><li class=article-tag-list-item><a class=article-tag-list-link href=https://xuanwo.io/tags/lenovo>Lenovo</a></li></ul></footer></div><nav id=article-nav><a href=/2019/03/10/request-id-in-grpc/ id=article-nav-newer class=article-nav-link-wrap><div class=article-nav-title><span>&lt;</span>&nbsp;
通过 gRPC 传递 Request ID</div></a><a href=/2019/02/16/second-day-at-osaka/ id=article-nav-older class=article-nav-link-wrap><div class=article-nav-title>大阪——风起雨落夜将至&nbsp;<span>&gt;</span></div></a></nav></article><div id=disqus_thread></div><script type=application/javascript>var disqus_config=function(){this.page.identifier='\/2019\/02\/19\/rollover-1st\/';this.page.title='翻车实况第 1 期';this.page.url='https:\/\/xuanwo.io\/2019\/02\/19\/rollover-1st\/';};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById('disqus_thread').innerHTML='Disqus comments not available by default when the website is previewed locally.';return;}
var d=document,s=d.createElement('script');s.async=true;s.src='//'+"only0god"+'.disqus.com/embed.js';s.setAttribute('data-timestamp',+new Date());(d.head||d.body).appendChild(s);})();</script><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></section><footer id=footer><div class=outer><div id=footer-info class=inner>&copy; 2019 Xuanwo&#39;s Blog&nbsp;
Powered by <a href=https://gohugo.io target=_blank>Hugo</a></div></div><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-51515330-1','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script><script src=https://cdn.jsdelivr.net/npm/tocbot@4/dist/tocbot.min.js></script><script>tocbot.init({tocSelector:'.article-toc',contentSelector:'.article-entry',headingSelector:'h1, h2, h3, h4, h5',});</script><script>document.getElementById('main-nav-toggle').addEventListener('click',function(){var header=document.getElementById('header');if(header.classList.contains('mobile-on')){header.classList.remove('mobile-on');}else{header.classList.add('mobile-on');}});</script></footer></div></body></html>