<!doctype html><html><head><title>docopt——好用的Python命令行参数解释器</title><meta charset=utf-8><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta name=description content="A blog maintained by an interesting programmer."><meta name=keywords content=Technology,Code,Program,Linux,><meta name=author content=Xuanwo><meta property=og:title content=docopt——好用的Python命令行参数解释器><meta property=og:description content="A blog maintained by an interesting programmer."><meta property=og:type content=website><meta property=og:locale content=en_US><meta property=og:url content=https://xuanwo.io/2016/04/04/docopt-intro/><link rel="shortcut icon" href=/favicon.ico><link rel=stylesheet href=https://xuanwo.io/css/main.min.deafbe194a3b5f545a05a06b15e2ee64805dec22ec7db1a0b4055de7b242c498.css integrity="sha256-3q&#43;&#43;GUo7X1RaBaBrFeLuZIBd7CLsfbGgtAVd57JCxJg="><link href=http://gmpg.org/xfn/11 rel=profile><meta name=generator content="Hugo 0.55.6"></head><body><nav class=nav><div class=nav-container><div class=brand><a href=https://xuanwo.io>Xuanwo&#39;s Blog</a></div><div class=links><a class=main-nav-link href=/about/>关于我</a>
<a class=main-nav-link href=/posts/>文章</a></div></div></nav><main id=main-content><article class="single container"><header class=single-header><div class=flex><h1>docopt——好用的Python命令行参数解释器</h1><div class=post-meta><time class=date datetime=2016-04-04T00:00:00.000&#43;00:00 itemprop=datePublished>2016-04-04</time>
/
<span><a href=#disqus_thread class=comment-link>Comments</a></span></div><div class=tag-container><a style=text-decoration:none href=https://xuanwo.io/tags/python><span>Python</span></a>
<a style=text-decoration:none href=https://xuanwo.io/tags/qingchat><span>qingchat</span></a></div></div></header><div class=post><p><a href=https://github.com/Xuanwo/qingchat><code>Qingchat</code></a> 使用的命令行参数解释器是 <a href=http://docopt.org/><code>docopt</code></a>，用下来感觉非常棒，所以决定介绍一下这个库。（*奉劝各位看官，珍爱生命，远离argparse。*）</p><h1 id=介绍>介绍</h1><p>docopt 本质上是在 Python 中引入了一种针对命令行参数的形式语言，在代码的最开头使用<code>&quot;&quot;&quot;</code>文档注释的形式写出符合要求的文档，就会自动生成对应的parse，体验非常赞。</p><h1 id=用法>用法</h1><h2 id=样例>样例</h2><p>docopt的使用非常简单，以Qingchat为例，你只需要在代码最开头加入：</p><div class=highlight><pre style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python><span style=color:#4070a0>&#34;&#34;&#34;Qingchat CLI
</span><span style=color:#4070a0>
</span><span style=color:#4070a0>Usage:
</span><span style=color:#4070a0>  qingchat config ip &lt;ip&gt;
</span><span style=color:#4070a0>  qingchat config port &lt;port&gt;
</span><span style=color:#4070a0>  qingchat config login
</span><span style=color:#4070a0>  qingchat group list
</span><span style=color:#4070a0>  qingchat group choose &lt;group_name&gt;...
</span><span style=color:#4070a0>  qingchat group clean
</span><span style=color:#4070a0>  qingchat group send -t &lt;content&gt;
</span><span style=color:#4070a0>  qingchat group send -i &lt;media&gt;
</span><span style=color:#4070a0>  qingchat group send -f &lt;file&gt; [&lt;delaytime&gt;]
</span><span style=color:#4070a0>
</span><span style=color:#4070a0>Options:
</span><span style=color:#4070a0>  -h --help     Show this screen.
</span><span style=color:#4070a0>  -v --version     Show version.
</span><span style=color:#4070a0>&#34;&#34;&#34;</span></code></pre></div><p>然后在执行代码中加入：</p><div class=highlight><pre style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python>arguments <span style=color:#666>=</span> docopt(__doc__, version<span style=color:#666>=</span><span style=color:#4070a0>&#39;Qingchat 0.3.2&#39;</span>)</code></pre></div><p>就会在你的程序中导入一个<code>arguments</code>字典，这个字典中的内容形如：</p><div class=highlight><pre style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python>{
    <span style=color:#4070a0>&#39;-f&#39;</span>: False,
    <span style=color:#4070a0>&#39;-i&#39;</span>: False,
    <span style=color:#4070a0>&#39;-t&#39;</span>: False,
    <span style=color:#4070a0>&#39;&lt;content&gt;&#39;</span>: None,
    <span style=color:#4070a0>&#39;&lt;file&gt;&#39;</span>: None,
    <span style=color:#4070a0>&#39;&lt;group_name&gt;&#39;</span>: [],
    <span style=color:#4070a0>&#39;&lt;ip&gt;&#39;</span>: <span style=color:#4070a0>&#39;127.0.0.1&#39;</span>,
    <span style=color:#4070a0>&#39;&lt;media&gt;&#39;</span>: None,
    <span style=color:#4070a0>&#39;&lt;port&gt;&#39;</span>: None,
    <span style=color:#4070a0>&#39;choose&#39;</span>: False,
    <span style=color:#4070a0>&#39;clean&#39;</span>: False,
    <span style=color:#4070a0>&#39;config&#39;</span>: True,
    <span style=color:#4070a0>&#39;group&#39;</span>: False,
    <span style=color:#4070a0>&#39;ip&#39;</span>: True,
    <span style=color:#4070a0>&#39;list&#39;</span>: False,
    <span style=color:#4070a0>&#39;login&#39;</span>: False,
    <span style=color:#4070a0>&#39;port&#39;</span>: False,
    <span style=color:#4070a0>&#39;send&#39;</span>: False
}</code></pre></div><p>这样应该就能很容易看出来，我们在文档中写的每一个短语，都被转化为一个对应的类型。只要直接调用<code>arguments['xxx']</code>就可以判断或者使用对应的值，从而实现对应的功能。</p><h2 id=详解>详解</h2><p>前面我们举了一个例子，下面我们来详细介绍一下如何完成一个符合 <code>docopt</code> 要求的注释文档。</p><h3 id=usage>Usage</h3><p>所有出现在<code>usage:</code>（区分大小写）和一个空行之间的文本都会被识别为一个命令组合，<code>usage</code>后的第一个字母将会被识别为这个程序的名字，所有命令组合的每一个部分（空格分隔）都会成为字典中的一个key。</p><h4 id=参数>参数</h4><p>形如 <code>&lt;argument&gt;</code> 或者 <code>ARGUMENT</code> 的文本将会被识别为参数。
在转化后的字典中的取值为 <code>True</code> 或者 <code>False</code> 。</p><div class=highlight><pre style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python>Usage: my_program <span style=color:#666>&lt;</span>host<span style=color:#666>&gt;</span> <span style=color:#666>&lt;</span>port<span style=color:#666>&gt;</span></code></pre></div><h4 id=选项>选项</h4><p>形如 <code>-o</code> 或者 <code>--option</code> 的文本将会被识别为选项。
在转化后的字典中的取值为 <code>True</code> 或者 <code>False</code> 。</p><div class=highlight><pre style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python>Usage: my_program <span style=color:#666>-</span>f <span style=color:#666>&lt;</span><span style=color:#007020>file</span><span style=color:#666>&gt;</span></code></pre></div><p>Tips:</p><ul><li>短选项可以组合起来，比如<code>-abc</code>等价于<code>-a -b -c</code></li><li>长选项需要的参数需要使用 <code>=</code> 或者空格来分隔，<code>--input=ARG</code> 等价于 <code>--input ARG</code></li><li>短选项可以不需要空格， <code>-f FILE</code> 等价于 <code>-fFILE</code></li></ul><h4 id=命令>命令</h4><p>其他不满足 <code>--options</code> 或者 <code>&lt;arguments&gt;</code> 的文本将会被识别为（子）命令。
在转化后的字典中取值为 <code>True</code> 或者 <code>False</code>。</p><h4 id=可选项>可选项</h4><p>形如 <code>[optional elements]</code> 的文本是可选项。
<code>elements</code>包括上述的三种类型：参数，选项以及命令。</p><p>在相同或者不同的括号中都是一样的：</p><div class=highlight><pre style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python>Usage: my_program [command <span style=color:#666>--</span>option <span style=color:#666>&lt;</span>argument<span style=color:#666>&gt;</span>]</code></pre></div><p>等价于</p><div class=highlight><pre style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python>Usage: my_program [command] [<span style=color:#666>--</span>option] [<span style=color:#666>&lt;</span>argument<span style=color:#666>&gt;</span>]</code></pre></div><h4 id=必填项>必填项</h4><p>形如 <code>(required elements)</code> 的文本是必填项。
上述三种元素默认都是必填项，<code>()</code>符号用在一些比较特殊的情形下，比如：</p><div class=highlight><pre style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python>Usage: my_program (<span style=color:#666>--</span>either<span style=color:#666>-</span>this <span style=color:#666>&lt;</span><span style=color:#007020;font-weight:700>and</span><span style=color:#666>-</span>that<span style=color:#666>&gt;</span> <span style=color:#666>|</span> <span style=color:#666>&lt;</span><span style=color:#007020;font-weight:700>or</span><span style=color:#666>-</span>this<span style=color:#666>&gt;</span>)</code></pre></div><h4 id=选择项>选择项</h4><p>形如 <code>element|another</code> 的文本是选择项，你可以从中选择一个值。</p><div class=highlight><pre style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python>Usage: my_program go (<span style=color:#666>--</span>up <span style=color:#666>|</span> <span style=color:#666>--</span>down <span style=color:#666>|</span> <span style=color:#666>--</span>left <span style=color:#666>|</span> <span style=color:#666>--</span>right)</code></pre></div><h4 id=列表项>列表项</h4><p>形如 <code>element...</code> 的文本是列表项，你可以输入多个参数。</p><p>比如说：</p><div class=highlight><pre style=background-color:#f0f0f0;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-python data-lang=python>Usage: my_program <span style=color:#007020>open</span> <span style=color:#666>&lt;</span><span style=color:#007020>file</span><span style=color:#666>&gt;...</span></code></pre></div><p>然后你可以通过<code>arguments['&lt;file&gt;']</code> 来访问这个列表。</p><h3 id=option>Option</h3><p><code>Option</code> 部分用于指定某些特殊情形，比如：</p><ul><li>将某个短参数与长参数关联起来，比如<code>-i &lt;file&gt;, --input &lt;file&gt;</code></li><li>某个选项有一个参数</li><li>选项的默认值，比如<code>--coefficient=K The K coefficient [default: 2.95]</code></li></ul><h3 id=校验>校验</h3><p>如果对自己完成的文档有疑问，可以使用<a href=http://try.docopt.org/>在线工具</a>进行校验。</p><h1 id=更新日志>更新日志</h1><ul><li>2016年04月04日 首次发布</li></ul></div><div id=disqus_thread></div><script type=application/javascript>let disqus_config=function(){this.page.identifier='\/2016\/04\/04\/docopt-intro\/';this.page.title='docopt——好用的Python命令行参数解释器';this.page.url='https:\/\/xuanwo.io\/2016\/04\/04\/docopt-intro\/';};(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!==-1){document.getElementById('disqus_thread').innerHTML='Disqus comments not available by default when the website is previewed locally.';return;}
let d=document,s=d.createElement('script');s.async=true;s.src='//only0god.disqus.com/embed.js';s.setAttribute('data-timestamp',+new Date());(d.head||d.body).appendChild(s);})();</script><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></article></main><footer class="footer container"><a class=main-nav-link href=/categories/>分类</a>
<a class=main-nav-link href=/tags/>标签</a>
<a class=main-nav-link href=/series/>专题</a>
<a class=main-nav-link href=/blogroll/>友链</a>
<a class=main-nav-link href=/index.xml>订阅</a>
<script type=application/javascript>var doNotTrack=false;if(!doNotTrack){window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;ga('create','UA-51515330-1','auto');ga('send','pageview');}</script><script async src=https://www.google-analytics.com/analytics.js></script></footer></body></html>